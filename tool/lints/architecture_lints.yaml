# Architecture import boundaries (custom_lint).
#
# This file is the single source of truth for architecture import rules:
# - IDE linting via `custom_lint`
# - CLI/CI checks via `dart run custom_lint` (wired into tool/verify.dart)
#
# Patterns are POSIX globs, relative to the repository root (use `/`).
version: 1
package_name: mobile_core_kit

rules:
  # Strict rule: core should not depend on features (enforced by default).
  #
  # TODO(core-boundary): Refactor so `core/di/**` only imports `features/*/di/**`
  # and `core/session/**` no longer imports `features/user/**` (move shared user/session
  # types or introduce core-owned abstractions).
  - id: core_no_features
    reason: Core code must not import feature code (except explicitly allowlisted cases).
    from: lib/core/**
    deny:
      - lib/features/**
    exceptions:
      # Allowed: core DI composes feature modules.
      - from: lib/core/di/**
        allow:
          - lib/features/*/di/**

  - id: features_no_cross_feature_imports
    reason: Feature code must not import other feature code. Move shared contracts to `lib/core/**`.
    from: lib/features/**
    deny:
      - lib/features/**
    exceptions:
      - from: lib/features/auth/**
        allow:
          - lib/features/auth/**

      - from: lib/features/home/**
        allow:
          - lib/features/home/**

      - from: lib/features/onboarding/**
        allow:
          - lib/features/onboarding/**

      - from: lib/features/profile/**
        allow:
          - lib/features/profile/**
          # TEMP: profile reuses auth logout UI + failure localizer.
          # TODO(guardrails): move shared auth UX contracts to `lib/core/**`.
          - lib/features/auth/presentation/cubit/logout/**
          - lib/features/auth/presentation/localization/auth_failure_localizer.dart
          # TEMP: profile screen wires user profile image UX.
          # TODO(guardrails): move shared profile image UX contracts to `lib/core/**`.
          - lib/features/user/presentation/cubit/profile_image/**

      - from: lib/features/user/**
        allow:
          - lib/features/user/**
          # TEMP: user feature reuses auth failure + VO contract.
          # TODO(guardrails): move shared auth/user failures + value failures to `lib/core/**`.
          - lib/features/auth/domain/failure/**
          - lib/features/auth/domain/value/value_failure.dart
          - lib/features/auth/presentation/localization/auth_failure_localizer.dart

  # Clean Architecture boundaries inside features.
  - id: feature_domain_no_data_or_presentation
    reason: Domain must not depend on data/presentation (or navigation).
    from: lib/features/*/domain/**
    deny:
      - lib/features/*/data/**
      - lib/features/*/presentation/**
      - lib/navigation/**

  - id: feature_domain_no_infra
    reason: Domain must not depend on infrastructure/UI framework concerns.
    from: lib/features/*/domain/**
    deny:
      - lib/core/network/**
      - lib/core/services/**
      - lib/core/storage/**
      - lib/core/database/**
      - lib/core/theme/**
      - lib/core/widgets/**
      - lib/core/adaptive/**
      - lib/core/di/**
      - lib/core/dev_tools/**
      - lib/l10n/**

  - id: feature_presentation_no_data
    reason: Presentation must not depend on data directly; go through usecases/repos.
    from: lib/features/*/presentation/**
    deny:
      - lib/features/*/data/**

  - id: feature_data_no_presentation_or_navigation
    reason: Data must not depend on presentation or navigation.
    from: lib/features/*/data/**
    deny:
      - lib/features/*/presentation/**
      - lib/navigation/**

  - id: navigation_no_feature_domain_or_data
    reason: Navigation composes UI only; it must not reach into feature domain/data.
    from: lib/navigation/**
    deny:
      - lib/features/*/domain/**
      - lib/features/*/data/**

  - id: feature_di_only_composed_from_core_di
    reason: Feature DI modules should only be imported by core DI composition.
    from: lib/**
    deny:
      - lib/features/*/di/**
    exceptions:
      - from: lib/core/di/**
        allow:
          - lib/features/*/di/**

  - id: no_service_locator_imports_outside_edges
    reason: Only composition roots may import the service locator.
    from: lib/**
    deny:
      - lib/core/di/service_locator.dart
    exceptions:
      - from: lib/core/di/**
        allow:
          - lib/core/di/service_locator.dart
      - from: lib/navigation/**
        allow:
          - lib/core/di/service_locator.dart
      - from: lib/app.dart
        allow:
          - lib/core/di/service_locator.dart
      - from: lib/main_*.dart
        allow:
          - lib/core/di/service_locator.dart
      - from: lib/features/*/di/**
        allow:
          - lib/core/di/service_locator.dart
